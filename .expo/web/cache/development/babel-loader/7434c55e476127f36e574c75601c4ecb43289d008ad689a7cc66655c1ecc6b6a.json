{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useEffect } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function MapPickerScreen(_ref) {\n  var navigation = _ref.navigation;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    markers = _useState2[0],\n    setMarkers = _useState2[1];\n  useEffect(function () {}, []);\n  var onMapClick = function onMapClick(latlng) {\n    if (markers.length >= 2) setMarkers([latlng]);else setMarkers([].concat(_toConsumableArray(markers), [latlng]));\n  };\n  var onUse = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      if (markers.length < 2) return Alert.alert('Select both pickup and delivery', 'Click on the map to set pickup (first) and delivery (second) markers.');\n      var pickup = markers[0][0] + \",\" + markers[0][1];\n      var delivery = markers[1][0] + \",\" + markers[1][1];\n      try {\n        var axios = require('axios');\n        var resp = yield axios.get('http://localhost:3333/api/directions', {\n          params: {\n            origin: pickup,\n            destination: delivery\n          }\n        });\n        if (resp.data && resp.data.routes && resp.data.routes.length) {\n          var route = resp.data.routes[0];\n          var meters = 0;\n          for (var leg of route.legs) meters += leg.distance.value;\n          var km = meters / 1000;\n          var overview = route.overview_polyline && route.overview_polyline.points;\n          var points = null;\n          if (overview) {\n            var _require = require(\"../utils/polylineDecode\"),\n              decodePolyline = _require.decodePolyline;\n            points = decodePolyline(overview);\n          }\n          navigation.navigate('SelectTruck', {\n            pickup: pickup,\n            delivery: delivery,\n            distanceKm: km,\n            polyline: points\n          });\n          return;\n        }\n        Alert.alert('No route found', 'Server returned no route. Falling back to straight-line distance.');\n      } catch (e) {\n        console.warn('Driving lookup failed', e.message || e);\n      }\n      try {\n        var _require2 = require(\"../utils/distance\"),\n          calculateDistanceKm = _require2.calculateDistanceKm;\n        var p = markers[0];\n        var d = markers[1];\n        var _km = calculateDistanceKm(p[0], p[1], d[0], d[1]);\n        navigation.navigate('SelectTruck', {\n          pickup: pickup,\n          delivery: delivery,\n          distanceKm: _km\n        });\n      } catch (e) {\n        Alert.alert('Error', 'Could not calculate distance.');\n      }\n    });\n    return function onUse() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  if (typeof document !== 'undefined') {\n    var ReactLeaflet = require('react-leaflet');\n    var MapContainer = ReactLeaflet.MapContainer,\n      TileLayer = ReactLeaflet.TileLayer,\n      Marker = ReactLeaflet.Marker,\n      useMapEvents = ReactLeaflet.useMapEvents,\n      Popup = ReactLeaflet.Popup,\n      Polyline = ReactLeaflet.Polyline;\n    var L = require('leaflet');\n    function ClickMap() {\n      useMapEvents({\n        click: function click(e) {\n          onMapClick([e.latlng.lat, e.latlng.lng]);\n        }\n      });\n      return null;\n    }\n    var positions = markers.map(function (m) {\n      return [m[0], m[1]];\n    });\n    return _jsxs(View, {\n      style: styles.container,\n      children: [_jsx(Text, {\n        style: styles.title,\n        children: \"Pick pickup and delivery on the map\"\n      }), _jsx(\"div\", {\n        style: {\n          height: '60vh',\n          width: '100%'\n        },\n        children: _jsxs(MapContainer, {\n          center: positions[0] || [26.2041, 28.0473],\n          zoom: 12,\n          style: {\n            height: '100%',\n            width: '100%'\n          },\n          children: [_jsx(TileLayer, {\n            url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n          }), _jsx(ClickMap, {}), positions.map(function (pos, i) {\n            return _jsx(Marker, {\n              position: pos,\n              children: _jsx(Popup, {\n                children: i === 0 ? 'Pickup' : 'Delivery'\n              })\n            }, i);\n          }), positions.length === 2 && _jsx(Polyline, {\n            positions: positions,\n            color: \"blue\"\n          })]\n        })\n      }), _jsx(View, {\n        style: {\n          marginTop: 12\n        },\n        children: _jsx(Button, {\n          title: \"Use these locations\",\n          onPress: onUse\n        })\n      })]\n    });\n  }\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(Text, {\n      style: styles.title,\n      children: \"Map picker is available in web builds only.\"\n    }), _jsx(Text, {\n      children: \"Use the address fields or enter coordinates instead.\"\n    }), _jsx(View, {\n      style: {\n        marginTop: 12\n      },\n      children: _jsx(Button, {\n        title: \"Back\",\n        onPress: function onPress() {\n          return navigation.goBack();\n        }\n      })\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    padding: 16,\n    backgroundColor: '#fff'\n  },\n  title: {\n    fontSize: 18,\n    fontWeight: '700',\n    marginBottom: 8\n  }\n});","map":{"version":3,"names":["React","useState","useEffect","View","Text","Button","StyleSheet","Alert","jsx","_jsx","jsxs","_jsxs","MapPickerScreen","_ref","navigation","_useState","_useState2","_slicedToArray","markers","setMarkers","onMapClick","latlng","length","concat","_toConsumableArray","onUse","_ref2","_asyncToGenerator","alert","pickup","delivery","axios","require","resp","get","params","origin","destination","data","routes","route","meters","leg","legs","distance","value","km","overview","overview_polyline","points","_require","decodePolyline","navigate","distanceKm","polyline","e","console","warn","message","_require2","calculateDistanceKm","p","d","apply","arguments","document","ReactLeaflet","MapContainer","TileLayer","Marker","useMapEvents","Popup","Polyline","L","ClickMap","click","lat","lng","positions","map","m","style","styles","container","children","title","height","width","center","zoom","url","pos","i","position","color","marginTop","onPress","goBack","create","flex","padding","backgroundColor","fontSize","fontWeight","marginBottom"],"sources":["/home/trevor/uz_dining_app/truck_delivery_app/screens/MapPickerScreen.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { View, Text, Button, StyleSheet, Alert } from 'react-native';\n\n// MapPicker is implemented for web (react-leaflet). Native apps will see a fallback message.\nexport default function MapPickerScreen({ navigation }) {\n  const [markers, setMarkers] = useState([]); // [{lat,lng}]\n\n  useEffect(() => {\n    // no-op\n  }, []);\n\n  const onMapClick = (latlng) => {\n    if (markers.length >= 2) setMarkers([latlng]);\n    else setMarkers([...markers, latlng]);\n  };\n\n  const onUse = async () => {\n    if (markers.length < 2) return Alert.alert('Select both pickup and delivery', 'Click on the map to set pickup (first) and delivery (second) markers.');\n    const pickup = `${markers[0][0]},${markers[0][1]}`;\n    const delivery = `${markers[1][0]},${markers[1][1]}`;\n\n    // Try driving distance via server\n    try {\n      const axios = require('axios');\n      const resp = await axios.get('http://localhost:3333/api/directions', { params: { origin: pickup, destination: delivery } });\n      if (resp.data && resp.data.routes && resp.data.routes.length) {\n        const route = resp.data.routes[0];\n        let meters = 0;\n        for (const leg of route.legs) meters += leg.distance.value;\n        const km = meters / 1000;\n        // decode polyline if available\n        const overview = route.overview_polyline && route.overview_polyline.points;\n        let points = null;\n        if (overview) {\n          const { decodePolyline } = require('../utils/polylineDecode');\n          points = decodePolyline(overview);\n        }\n        // navigate directly to SelectTruck with distance\n        navigation.navigate('SelectTruck', { pickup, delivery, distanceKm: km, polyline: points });\n        return;\n      }\n      Alert.alert('No route found', 'Server returned no route. Falling back to straight-line distance.');\n    } catch (e) {\n      console.warn('Driving lookup failed', e.message || e);\n      // continue to fallback\n    }\n\n    // fallback: compute straight-line distance using utils\n    try {\n      const { calculateDistanceKm } = require('../utils/distance');\n      const p = markers[0];\n      const d = markers[1];\n      const km = calculateDistanceKm(p[0], p[1], d[0], d[1]);\n      navigation.navigate('SelectTruck', { pickup, delivery, distanceKm: km });\n    } catch (e) {\n      Alert.alert('Error', 'Could not calculate distance.');\n    }\n  };\n\n  // Web render uses react-leaflet; native shows a message\n  if (typeof document !== 'undefined') {\n    const ReactLeaflet = require('react-leaflet');\n    const { MapContainer, TileLayer, Marker, useMapEvents, Popup, Polyline } = ReactLeaflet;\n    const L = require('leaflet');\n\n    // small marker component to capture clicks\n    function ClickMap() {\n      useMapEvents({\n        click(e) { onMapClick([e.latlng.lat, e.latlng.lng]); }\n      });\n      return null;\n    }\n\n    const positions = markers.map((m) => [m[0], m[1]]);\n\n    return (\n      <View style={styles.container}>\n        <Text style={styles.title}>Pick pickup and delivery on the map</Text>\n        <div style={{ height: '60vh', width: '100%' }}>\n          <MapContainer center={positions[0] || [26.2041, 28.0473]} zoom={12} style={{ height: '100%', width: '100%' }}>\n            <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\n            <ClickMap />\n            {positions.map((pos, i) => (\n              <Marker key={i} position={pos}>\n                <Popup>{i === 0 ? 'Pickup' : 'Delivery'}</Popup>\n              </Marker>\n            ))}\n            {positions.length === 2 && <Polyline positions={positions} color=\"blue\" />}\n          </MapContainer>\n        </div>\n\n        <View style={{ marginTop: 12 }}>\n          <Button title=\"Use these locations\" onPress={onUse} />\n        </View>\n      </View>\n    );\n  }\n\n  return (\n    <View style={styles.container}>\n      <Text style={styles.title}>Map picker is available in web builds only.</Text>\n      <Text>Use the address fields or enter coordinates instead.</Text>\n      <View style={{ marginTop: 12 }}>\n        <Button title=\"Back\" onPress={() => navigation.goBack()} />\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: { flex: 1, padding: 16, backgroundColor: '#fff' },\n  title: { fontSize: 18, fontWeight: '700', marginBottom: 8 }\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}